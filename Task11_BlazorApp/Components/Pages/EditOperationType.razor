@using Services
@using Task11_Common.ViewModels

@page "/operationtypes/edit/{id:int}"

@inject IOperationTypeService OperationTypeService
@inject NavigationManager NavigationManager
@rendermode InteractiveServer


<h3>Edit Operation Type</h3>

@if (string.IsNullOrEmpty(errorMessage))
{
    if (operationType == null)
    {
        <p><em>Loading...</em></p>
    }
    else
    {
        <p>Name:<input type="text" @bind="@operationType.Name" /></p>

        <p>Income/Expense:
           <select @oninput="HandleChange" @bind="operationType.IsIncome">
                <option value="true" selected=@(operationType.IsIncome ? "selected" : "")>Income</option>
                <option value="false" selected=@(!operationType.IsIncome ? "selected" : "")>Expense</option>
            </select>
        </p>

        <p>Selected Value: @operationType.IsIncome</p> 
        <p>Description:<input type="text" @bind="@operationType.Description"/></p>
        <button @onclick="UpdateOperationType">Update</button>

        if (!String.IsNullOrEmpty(errorMessage))
        {
            <div class="alert alert-success">@resultMessage</div>
        }
    }
}


@code {
    [Parameter]
    public int Id { get; set; }
    private string errorMessage;
    private string resultMessage;

    private string selectedValue;
    public string IsIncomeValue 
    { 
        get => operationType.IsIncome.ToString(); 
        set => operationType.IsIncome = bool.Parse(value); 
    }

    private OperationTypeViewModelCommon operationType;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            operationType = await OperationTypeService.GetOperationTypeById(Id);
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
        }    
    }

    private async Task UpdateOperationType()
    {
        resultMessage = await OperationTypeService.UpdateOperationType(operationType.Id, operationType);
        NavigationManager.NavigateTo("/operationtypes");
    }

    private void HandleChange(ChangeEventArgs e)
    {
        if (e.Value.ToString() == "true")
        {
            operationType.IsIncome = true;
        }
        else
        {
            operationType.IsIncome = false;
        }
    }
}
